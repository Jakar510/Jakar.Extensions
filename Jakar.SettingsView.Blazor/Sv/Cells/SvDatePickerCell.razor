@using System.Diagnostics
@using Radzen
@using Radzen.Blazor
@inherits ValueCellBase<DateTime>


<div class="@SV_CELL_BODY @Class"
     id="@ID" >
    <div class="@SV_CELL_BODY_TITLE"
         id="@ID-title" >
        @Title
    </div>
    <div class="@SV_CELL_BODY_DESCRIPTION"
         id="@ID-description" >
        @Description
    </div>
    <div class="@SV_CELL_BODY_HINT"
         id="@ID-hint" >
        @Hint
    </div>
    <div Class="@SV_CELL_BODY_VALUE_ENTRY"
         type="datetime-local"
         UniqueID="@ID-value" >
        <RadzenDatePicker PopupRenderMode="PopupRenderMode.OnDemand"
                          @ref="_picker"
                          TValue="DateTime"
                          Value="@Value"
                          ValueChanged="@ValueChanged"
                          ValueExpression="@ValueExpression" />
    </div>

    <ValidationMessage For="@ValueExpression" />
</div>


@code
{
    public const       string                       DATE_FORMAT      = "yyyy-MM-dd";
    public const       string                       TIME_FORMAT      = "HH:mm:ss.fffffffzzz";
    public const       string                       DATE_TIME_FORMAT = "yyyy-MM-ddTHH:mm:ss.fffffffzzz";
    private            RadzenDatePicker<DateTime>?  _picker;
    public override    WidgetType                   Type             => WidgetType.Date;
    [Parameter] public bool                         AllowClear       { get; set; }
    [Parameter] public int                          TabIndex         { get; set; }
    [Parameter] public string                       InputClass       { get; set; } = string.Empty;
    [Parameter] public DateTime?                    InitialViewDate  { get; set; }
    [Parameter] public Action<DateRenderEventArgs>? DateRender       { get; set; }
    [Parameter] public DateTimeKind                 Kind             { get; set; } = DateTimeKind.Local;
    [Parameter] public bool                         TimeOnly         { get; set; }
    [Parameter] public bool                         ReadOnly         { get; set; }
    [Parameter] public bool                         AllowInput       { get; set; }
    [Parameter] public bool                         ShowButton       { get; set; } = true;
    [Parameter] public bool                         ShowDays         { get; set; } = true;
    [Parameter] public bool                         ShowTime         { get; set; }
    [Parameter] public bool                         ShowSeconds      { get; set; }
    [Parameter] public bool                         PadHours         { get; set; }
    [Parameter] public bool                         PadMinutes       { get; set; }
    [Parameter] public bool                         PadSeconds       { get; set; }
    [Parameter] public bool                         ShowTimeOkButton { get; set; }
    [Parameter] public string                       DateFormat       { get; set; } = DATE_TIME_FORMAT;
    [Parameter] public string                       HourFormat       { get; set; } = "12";
    [Parameter] public string                       Placeholder      { get; set; } = string.Empty;


    protected override Task OnParametersSetAsync()
    {
        Debug.Assert(_picker is not null, nameof(_picker));

        _picker.Change             = new EventCallback<DateTime?>(this, SetValue);
        _picker.CurrentDateChanged = new EventCallback<DateTime>(this, SetValue);
        _picker.InitialViewDate    = Value;
        _picker.Min                = Min;
        _picker.Max                = Max;
        _picker.TabIndex           = TabIndex;
        _picker.DateRender         = DateRender;
        _picker.Culture            = Culture;
        _picker.DefaultCulture     = DefaultCulture;
        _picker.TimeOnly           = TimeOnly;
        _picker.ReadOnly           = ReadOnly;
        _picker.AllowInput         = AllowInput;
        _picker.ShowButton         = ShowButton;
        _picker.Disabled           = IsDisabled;
        _picker.ShowDays           = ShowDays;
        _picker.ShowTime           = ShowTime;
        _picker.ShowSeconds        = ShowSeconds;
        _picker.PadHours           = PadHours;
        _picker.PadMinutes         = PadMinutes;
        _picker.PadSeconds         = PadSeconds;
        _picker.ShowTimeOkButton   = ShowTimeOkButton;
        _picker.DateFormat         = DateFormat;
        _picker.HourFormat         = HourFormat;
        _picker.Placeholder        = Placeholder;

        return base.OnParametersSetAsync();
    }

}
